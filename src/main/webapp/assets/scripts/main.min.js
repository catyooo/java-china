function go_signin(){swal({title:"提示信息",text:"您没有登录，3秒后跳转到登录页面！",type:"warning",confirmButtonText:"点击跳转",timer:3e3},function(a){a?setTimeout(function(){window.location.href=BASE+"/signin"},300):window.location.href=BASE+"/signin"})}function len(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}function openWindow(a,b,c,d){var e=(window.screen.availHeight-30-d)/2,f=(window.screen.availWidth-10-c)/2;window.open(a,b,"height="+d+",,innerHeight="+d+",width="+c+",innerWidth="+c+",top="+e+",left="+f+",status=no,toolbar=no,menubar=no,location=no,resizable=no,scrollbars=0,titlebar=no")}function alertError(a){swal({title:"提示信息",text:a,type:"error",timer:3e3})}function alertOk(a){swal({title:"提示信息",text:a,type:"success",timer:3e3})}function dispatch(){var b,a=document.getElementById("q");return""!=a.value?(b="https://www.google.com/search?q=site:java-china.org/topic%20"+a.value,navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPhone")>-1?location.href=b:window.open(b,"_blank"),!1):!1}function unique(a){var b=[];return $.each(a,function(a,c){-1===$.inArray(c,b)&&b.push(c)}),b}function emoji(a){return a&&-1!=a.indexOf(":")?a.replace(/:([a-z-_]{2,30}):/g,"<img src='"+CDN_URL+"/assets/emojis/$1.png'  height='20' width='20' />"):a}function change_captcha(){var a=(new Date).valueOf();return $("#captcha").attr("src",BASE+"/captcha?t="+a),!1}var info_data,topic,user,github;$("#topic-add .preview").on("click",function(){var a=$("#topic-add #content").val();a?$.post(BASE+"/markdown",{content:a},function(a){a&&($("#markdown_preview").html(a).removeClass("hide"),$("#markdown_preview pre code").each(function(a,b){hljs.highlightBlock(b)}))}):$("#markdown_preview").html("").addClass("hide")}),$("#topic-edit .preview").on("click",function(){var a=$("#topic-edit #content").val();a?$.post(BASE+"/markdown",{content:a},function(a){a&&($("#markdown_preview").html(a).removeClass("hide"),$("#markdown_preview pre code").each(function(a,b){hljs.highlightBlock(b)}))}):$("#markdown_preview").html("").addClass("hide")}),$(".topic-footer .heart").on("click",function(){var d,e,f,g,a=$(this).attr("id"),b=a.split("like");b[1],d=parseInt($("#likeCount").text()),$(this).css("background-position",""),e=$("#likeCount"),f=$(this),g=$(this).attr("tid"),$.post(BASE+"/favorite",{type:"love",event_id:g},function(a){a&&(200==a.status?(1==a.data&&(e.text(d+1),f.addClass("heartAnimation").attr("rel","unlike")),-1==a.data&&(e.text(d-1),f.removeClass("heartAnimation").attr("rel","like"),f.css("background-position","left"))):401==a.status?go_signin():alertError(a.msg))})}),$(".topic-detail-heading .sinks").on("click",function(){var a=$(this).attr("tid");$(this),$.post(BASE+"/sink",{tid:a},function(a){a&&(200==a.status?window.location.reload():401==a.status?go_signin():alertError(a.msg))})}),$(".topic-footer .follow").on("click",function(){var a=$(this).attr("tid");$(this),$.post(BASE+"/favorite",{type:"topic",event_id:a},function(a){a&&(200==a.status?window.location.reload():401==a.status?go_signin():alertError(a.msg))})}),$(".topic-footer .essence").on("click",function(){var a=$(this).attr("tid");$(this),$.post(BASE+"/essence",{tid:a},function(a){a&&(200==a.status?window.location.reload():401==a.status?go_signin():alertError(a.msg))})}),$(".topic-footer .share-weibo").on("click",function(){var a=$(".topic-detail-heading .panel-title").text(),b=window.location.href,c="http://service.weibo.com/share/share.php?url="+b+"&title="+encodeURI(a);openWindow(c,"",550,422)}),$(".comment-list .at-user").on("click",function(){var e,a=$(this).attr("alt"),b=$("#comment-form #content"),c=b.val(),d="@"+a+" ";c==d?b.val(""):(e=c?"\r\n":"",b.val(c+e+d)),b.focus()}),$(".profile .following").on("click",function(){var a=$(this).attr("uid");$(this),$.post(BASE+"/favorite",{type:"following",event_id:a},function(a){a&&(200==a.status?window.location.reload():401==a.status?go_signin():alertError(a.msg))})}),$(".node-head .favorite").on("click",function(){var a=$(this).attr("nid");$(this),$.post(BASE+"/favorite",{type:"node",event_id:a},function(a){a&&(200==a.status?window.location.reload():401==a.status?go_signin():alertError(a.msg))})}),info_data={},$("#info_form :input").change(function(){var a=$(this).attr("name");info_data[a]=$(this).val()}),$("#info_form .submit").on("click",function(a){if(a.preventDefault(),len(info_data)>0){var b=Ladda.create(this);b.start(),$.post(BASE+"/settings?type=info",info_data,function(a){info_data={},setTimeout(function(){b.stop()},600),a&&(200==a.status?alertOk("修改成功！"):401==a.status?go_signin():alertError(a.msg))})}}),$("#topic-add .ladda-button").on("click",function(a){var b,c,d;return a.preventDefault(),b=$("#topic-add")[0],b.checkValidity()&&(c=Ladda.create(this),c.start(),d=$("#topic-add").serialize(),$.post(BASE+"/topic/add",d,function(a){setTimeout(function(){c.stop()},600),a&&(200==a.status?window.location.href=BASE+"/topic/"+a.data:401==a.status?go_signin():alertError(a.msg))})),!0}),$("#comment-form .ladda-button").on("click",function(a){var b,c,d;return a.preventDefault(),b=$("#comment-form")[0],b.checkValidity()&&(c=Ladda.create(this),c.start(),d=$("#comment-form").serialize(),$.post(BASE+"/comment/add",d,function(a){setTimeout(function(){c.stop()},600),a&&(200==a.status?window.location.reload():401==a.status?go_signin():alertError(a.msg))})),!0}),topic={},topic.edit=function(){var a=$("#topic-edit").serialize();return $.post(BASE+"/topic/edit",a,function(a){a&&(200==a.status?window.location.href=BASE+"/topic/"+a.data:401==a.status?go_signin():alertError(a.msg))}),!1},user={},user.update_avatar=function(){var a=$("#avatar_form #user_avatar").val();a&&""!=a&&$.post(BASE+"/settings",{type:"avatar",avatar:a},function(a){a&&(200==a.status?alertOk("头像更换成功!"):401==a.status?go_signin():alertError(a.msg))})},user.update_pwd=function(){var a=$("#pwd_form").serialize();$.post(BASE+"/settings?type=pwd",a,function(a){a&&(200==a.status?alertOk("密码修改成功!"):401==a.status?go_signin():alertError(a.msg))})},github={},github.signup=function(){return $.post(BASE+"/oauth/user/bind",{type:"signup",login_name:$("#github_signup_form #login_name").val(),email:$("#github_signup_form #email").val(),pass_word:$("#github_signup_form #pass_word").val()},function(a){a&&("exist_login"==a&&alertError("用户已存在，请绑定已有帐号!"),"exist_email"==a?alertError("邮箱已存在，请绑定已有帐号!"):"success"==a?($("#github-bind-tab").hide(),$("#github-tab-content").hide(),$(".col-md-9 #result").removeClass("hide").html("注册成功，已经向您的邮箱 "+$("#github_signup_form #email").val()+" 发送了一封激活申请，请注意查收！"+"如未收到邮件可在垃圾邮件里查看或者联系网站管理员进行激活。")):"failure"==a&&alertError("绑定失败!"))}),!1},github.signin=function(){return $.post(BASE+"/oauth/user/bind",{type:"signin",login_name:$("#github_signin_form #login_name").val(),pass_word:$("#github_signin_form #pass_word").val()},function(a){a&&("no_user"==a?alertError("不存在该用户!"):"pwd_error"==a?alertError("用户名或密码错误!"):"no_active"==a?alertError("该用户未激活，请激活后进行绑定!"):"success"==a&&(window.location.href=BASE))}),!1};